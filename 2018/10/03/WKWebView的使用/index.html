<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="iOS,WKWebView," />










<meta name="description" content="å‰è¨€ æœ€è¿‘é¡¹ç›®ä¸­çš„UIWebViewè¢«æ›¿æ¢ä¸ºäº†WKWebViewï¼Œå› æ­¤æ¥æ€»ç»“ä¸€ä¸‹ã€‚ç¤ºä¾‹Demoï¼šWKWebViewçš„ä½¿ç”¨æœ¬æ–‡å°†ä»ä»¥ä¸‹å‡ æ–¹é¢ä»‹ç»WKWebViewï¼š   1ã€WKWebViewæ¶‰åŠçš„ä¸€äº›ç±»  2ã€WKWebViewæ¶‰åŠçš„ä»£ç†æ–¹æ³•  3ã€ç½‘é¡µå†…å®¹åŠ è½½è¿›åº¦æ¡å’Œtitleçš„å®ç° 4ã€JSå’ŒOCçš„äº¤äº’ 5ã€æœ¬åœ°HTMLæ–‡ä»¶çš„å®ç°   ä¸€ã€WKWebViewæ¶‰åŠçš„ä¸€äº›ç±» WKWebViewï¼š">
<meta name="keywords" content="iOS,WKWebView">
<meta property="og:type" content="article">
<meta property="og:title" content="iOS WKWebViewçš„ä½¿ç”¨">
<meta property="og:url" content="http://yoursite.com/2018/10/03/WKWebViewçš„ä½¿ç”¨/index.html">
<meta property="og:site_name" content="DoubleDragon&#39;s Blog">
<meta property="og:description" content="å‰è¨€ æœ€è¿‘é¡¹ç›®ä¸­çš„UIWebViewè¢«æ›¿æ¢ä¸ºäº†WKWebViewï¼Œå› æ­¤æ¥æ€»ç»“ä¸€ä¸‹ã€‚ç¤ºä¾‹Demoï¼šWKWebViewçš„ä½¿ç”¨æœ¬æ–‡å°†ä»ä»¥ä¸‹å‡ æ–¹é¢ä»‹ç»WKWebViewï¼š   1ã€WKWebViewæ¶‰åŠçš„ä¸€äº›ç±»  2ã€WKWebViewæ¶‰åŠçš„ä»£ç†æ–¹æ³•  3ã€ç½‘é¡µå†…å®¹åŠ è½½è¿›åº¦æ¡å’Œtitleçš„å®ç° 4ã€JSå’ŒOCçš„äº¤äº’ 5ã€æœ¬åœ°HTMLæ–‡ä»¶çš„å®ç°   ä¸€ã€WKWebViewæ¶‰åŠçš„ä¸€äº›ç±» WKWebViewï¼š">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/1708447-eb27b4d6eab2cc75.gif?imageMogr2/auto-orient/strip">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/1708447-44824f3cec7bad72.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/1708447-8039532e25fcee13.gif?imageMogr2/auto-orient/strip">
<meta property="og:updated_time" content="2018-10-03T10:35:35.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="iOS WKWebViewçš„ä½¿ç”¨">
<meta name="twitter:description" content="å‰è¨€ æœ€è¿‘é¡¹ç›®ä¸­çš„UIWebViewè¢«æ›¿æ¢ä¸ºäº†WKWebViewï¼Œå› æ­¤æ¥æ€»ç»“ä¸€ä¸‹ã€‚ç¤ºä¾‹Demoï¼šWKWebViewçš„ä½¿ç”¨æœ¬æ–‡å°†ä»ä»¥ä¸‹å‡ æ–¹é¢ä»‹ç»WKWebViewï¼š   1ã€WKWebViewæ¶‰åŠçš„ä¸€äº›ç±»  2ã€WKWebViewæ¶‰åŠçš„ä»£ç†æ–¹æ³•  3ã€ç½‘é¡µå†…å®¹åŠ è½½è¿›åº¦æ¡å’Œtitleçš„å®ç° 4ã€JSå’ŒOCçš„äº¤äº’ 5ã€æœ¬åœ°HTMLæ–‡ä»¶çš„å®ç°   ä¸€ã€WKWebViewæ¶‰åŠçš„ä¸€äº›ç±» WKWebViewï¼š">
<meta name="twitter:image" content="https://upload-images.jianshu.io/upload_images/1708447-eb27b4d6eab2cc75.gif?imageMogr2/auto-orient/strip">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'åšä¸»'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2018/10/03/WKWebViewçš„ä½¿ç”¨/"/>





  <title>iOS WKWebViewçš„ä½¿ç”¨ | DoubleDragon's Blog</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">DoubleDragon's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">Rome was not built in one day. Study hard and make progress every day.</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            é¦–é¡µ
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            æ ‡ç­¾
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            åˆ†ç±»
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            å½’æ¡£
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/10/03/WKWebViewçš„ä½¿ç”¨/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ä¸”è¡Œä¸”çæƒœ_iOS">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://upload.jianshu.io/collections/images/1661007/è‰¾ç›Â·æ²ƒç‰¹æ£®.jpeg?imageMogr2/auto-orient/strip|imageView2/1/w/240/h/240">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="DoubleDragon's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">iOS WKWebViewçš„ä½¿ç”¨</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2018-10-03T18:34:48+08:00">
                2018-10-03
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/iOSçš„ç‚¹ç‚¹æ»´æ»´/" itemprop="url" rel="index">
                    <span itemprop="name">iOSçš„ç‚¹ç‚¹æ»´æ»´</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p><img src="https://upload-images.jianshu.io/upload_images/1708447-eb27b4d6eab2cc75.gif?imageMogr2/auto-orient/strip" alt="WKWebViewçš„ä½¿ç”¨"></p>
<h3 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h3><blockquote>
<p>æœ€è¿‘é¡¹ç›®ä¸­çš„UIWebViewè¢«æ›¿æ¢ä¸ºäº†WKWebViewï¼Œå› æ­¤æ¥æ€»ç»“ä¸€ä¸‹ã€‚<br>ç¤ºä¾‹Demoï¼š<a href="https://github.com/wslcmk/WKWebView" target="_blank" rel="noopener">WKWebViewçš„ä½¿ç”¨</a><br>æœ¬æ–‡å°†ä»ä»¥ä¸‹å‡ æ–¹é¢ä»‹ç»WKWebViewï¼š </p>
<ul>
<li>1ã€WKWebViewæ¶‰åŠçš„ä¸€äº›ç±» </li>
<li>2ã€WKWebViewæ¶‰åŠçš„ä»£ç†æ–¹æ³• </li>
<li>3ã€ç½‘é¡µå†…å®¹åŠ è½½è¿›åº¦æ¡å’Œtitleçš„å®ç°</li>
<li>4ã€JSå’ŒOCçš„äº¤äº’</li>
<li>5ã€æœ¬åœ°HTMLæ–‡ä»¶çš„å®ç°</li>
</ul>
</blockquote>
<h2 id="ä¸€ã€WKWebViewæ¶‰åŠçš„ä¸€äº›ç±»"><a href="#ä¸€ã€WKWebViewæ¶‰åŠçš„ä¸€äº›ç±»" class="headerlink" title="ä¸€ã€WKWebViewæ¶‰åŠçš„ä¸€äº›ç±»"></a>ä¸€ã€WKWebViewæ¶‰åŠçš„ä¸€äº›ç±»</h2><ul>
<li>WKWebViewï¼šç½‘é¡µçš„æ¸²æŸ“ä¸å±•ç¤º</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">æ³¨æ„ï¼š #import &lt;WebKit/WebKit.h&gt;</span><br><span class="line">//åˆå§‹åŒ–</span><br><span class="line">_webView = [[WKWebView alloc] initWithFrame:CGRectMake(0, 0, SCREEN_WIDTH, SCREEN_HEIGHT) configuration:config];</span><br><span class="line">// UIä»£ç†</span><br><span class="line">_webView.UIDelegate = self;</span><br><span class="line">// å¯¼èˆªä»£ç†</span><br><span class="line">_webView.navigationDelegate = self;</span><br><span class="line">// æ˜¯å¦å…è®¸æ‰‹åŠ¿å·¦æ»‘è¿”å›ä¸Šä¸€çº§, ç±»ä¼¼å¯¼èˆªæ§åˆ¶çš„å·¦æ»‘è¿”å›</span><br><span class="line">_webView.allowsBackForwardNavigationGestures = YES;</span><br><span class="line">//å¯è¿”å›çš„é¡µé¢åˆ—è¡¨, å­˜å‚¨å·²æ‰“å¼€è¿‡çš„ç½‘é¡µ </span><br><span class="line">WKBackForwardList * backForwardList = [_webView backForwardList];</span><br><span class="line"></span><br><span class="line">//        NSMutableURLRequest *request = [NSMutableURLRequest requestWithURL:[NSURL URLWithString:@&quot;http://www.chinadaily.com.cn&quot;]];</span><br><span class="line">//        [request addValue:[self readCurrentCookieWithDomain:@&quot;http://www.chinadaily.com.cn&quot;] forHTTPHeaderField:@&quot;Cookie&quot;];</span><br><span class="line">//        [_webView loadRequest:request];</span><br><span class="line">//é¡µé¢åé€€</span><br><span class="line">[_webView goBack];</span><br><span class="line">//é¡µé¢å‰è¿›</span><br><span class="line">[_webView goForward];</span><br><span class="line">//åˆ·æ–°å½“å‰é¡µé¢</span><br><span class="line">[_webView reload];</span><br><span class="line"></span><br><span class="line">NSString *path = [[NSBundle mainBundle] pathForResource:@&quot;JStoOC.html&quot; ofType:nil];</span><br><span class="line">NSString *htmlString = [[NSString alloc]initWithContentsOfFile:path encoding:NSUTF8StringEncoding error:nil];</span><br><span class="line">//åŠ è½½æœ¬åœ°htmlæ–‡ä»¶</span><br><span class="line">[_webView loadHTMLString:htmlString baseURL:[NSURL fileURLWithPath:[[NSBundle mainBundle] bundlePath]]];</span><br></pre></td></tr></table></figure>
<ul>
<li>WKWebViewConfigurationï¼šä¸ºæ·»åŠ WKWebViewé…ç½®ä¿¡æ¯</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">//åˆ›å»ºç½‘é¡µé…ç½®å¯¹è±¡</span><br><span class="line">WKWebViewConfiguration *config = [[WKWebViewConfiguration alloc] init];</span><br><span class="line"></span><br><span class="line">// åˆ›å»ºè®¾ç½®å¯¹è±¡</span><br><span class="line">WKPreferences *preference = [[WKPreferences alloc]init];</span><br><span class="line">//æœ€å°å­—ä½“å¤§å° å½“å°†javaScriptEnabledå±æ€§è®¾ç½®ä¸ºNOæ—¶ï¼Œå¯ä»¥çœ‹åˆ°æ˜æ˜¾çš„æ•ˆæœ</span><br><span class="line">preference.minimumFontSize = 0;</span><br><span class="line">//è®¾ç½®æ˜¯å¦æ”¯æŒjavaScript é»˜è®¤æ˜¯æ”¯æŒçš„</span><br><span class="line">preference.javaScriptEnabled = YES;</span><br><span class="line">// åœ¨iOSä¸Šé»˜è®¤ä¸ºNOï¼Œè¡¨ç¤ºæ˜¯å¦å…è®¸ä¸ç»è¿‡ç”¨æˆ·äº¤äº’ç”±javaScriptè‡ªåŠ¨æ‰“å¼€çª—å£</span><br><span class="line">preference.javaScriptCanOpenWindowsAutomatically = YES;</span><br><span class="line">config.preferences = preference;</span><br><span class="line"></span><br><span class="line">// æ˜¯ä½¿ç”¨h5çš„è§†é¢‘æ’­æ”¾å™¨åœ¨çº¿æ’­æ”¾, è¿˜æ˜¯ä½¿ç”¨åŸç”Ÿæ’­æ”¾å™¨å…¨å±æ’­æ”¾</span><br><span class="line">config.allowsInlineMediaPlayback = YES;</span><br><span class="line">//è®¾ç½®è§†é¢‘æ˜¯å¦éœ€è¦ç”¨æˆ·æ‰‹åŠ¨æ’­æ”¾  è®¾ç½®ä¸ºNOåˆ™ä¼šå…è®¸è‡ªåŠ¨æ’­æ”¾</span><br><span class="line">config.requiresUserActionForMediaPlayback = YES;</span><br><span class="line">//è®¾ç½®æ˜¯å¦å…è®¸ç”»ä¸­ç”»æŠ€æœ¯ åœ¨ç‰¹å®šè®¾å¤‡ä¸Šæœ‰æ•ˆ</span><br><span class="line">config.allowsPictureInPictureMediaPlayback = YES;</span><br><span class="line">//è®¾ç½®è¯·æ±‚çš„User-Agentä¿¡æ¯ä¸­åº”ç”¨ç¨‹åºåç§° iOS9åå¯ç”¨</span><br><span class="line">config.applicationNameForUserAgent = @&quot;ChinaDailyForiPad&quot;;</span><br><span class="line">//è‡ªå®šä¹‰çš„WKScriptMessageHandler æ˜¯ä¸ºäº†è§£å†³å†…å­˜ä¸é‡Šæ”¾çš„é—®é¢˜</span><br><span class="line">WeakWebViewScriptMessageDelegate *weakScriptMessageDelegate = [[WeakWebViewScriptMessageDelegate alloc] initWithDelegate:self];</span><br><span class="line">//è¿™ä¸ªç±»ä¸»è¦ç”¨æ¥åšnativeä¸JavaScriptçš„äº¤äº’ç®¡ç†</span><br><span class="line">WKUserContentController * wkUController = [[WKUserContentController alloc] init];</span><br><span class="line">//æ³¨å†Œä¸€ä¸ªnameä¸ºjsToOcNoPramsçš„jsæ–¹æ³•</span><br><span class="line">[wkUController addScriptMessageHandler:weakScriptMessageDelegate  name:@&quot;jsToOcNoPrams&quot;];</span><br><span class="line">[wkUController addScriptMessageHandler:weakScriptMessageDelegate  name:@&quot;jsToOcWithPrams&quot;]; </span><br><span class="line">config.userContentController = wkUController;</span><br></pre></td></tr></table></figure>
<ul>
<li>WKUserScriptï¼šç”¨äºè¿›è¡ŒJavaScriptæ³¨å…¥</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">//ä»¥ä¸‹ä»£ç é€‚é…æ–‡æœ¬å¤§å°ï¼Œç”±UIWebViewæ¢ä¸ºWKWebViewåï¼Œä¼šå‘ç°å­—ä½“å°äº†å¾ˆå¤šï¼Œè¿™åº”è¯¥æ˜¯WKWebViewä¸htmlçš„å…¼å®¹é—®é¢˜ï¼Œè§£å†³åŠæ³•æ˜¯ä¿®æ”¹åŸç½‘é¡µï¼Œè¦ä¹ˆæˆ‘ä»¬æ‰‹åŠ¨æ³¨å…¥JS</span><br><span class="line">NSString *jSString = @&quot;var meta = document.createElement(&apos;meta&apos;); meta.setAttribute(&apos;name&apos;, &apos;viewport&apos;); meta.setAttribute(&apos;content&apos;, &apos;width=device-width&apos;); document.getElementsByTagName(&apos;head&apos;)[0].appendChild(meta);&quot;;</span><br><span class="line">//ç”¨äºè¿›è¡ŒJavaScriptæ³¨å…¥</span><br><span class="line">WKUserScript *wkUScript = [[WKUserScript alloc] initWithSource:jSString injectionTime:WKUserScriptInjectionTimeAtDocumentEnd forMainFrameOnly:YES];</span><br><span class="line">[config.userContentController addUserScript:wkUScript];</span><br></pre></td></tr></table></figure>
<ul>
<li>WKUserContentControllerï¼šè¿™ä¸ªç±»ä¸»è¦ç”¨æ¥åšnativeä¸JavaScriptçš„äº¤äº’ç®¡ç†</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">//è¿™ä¸ªç±»ä¸»è¦ç”¨æ¥åšnativeä¸JavaScriptçš„äº¤äº’ç®¡ç†</span><br><span class="line">WKUserContentController * wkUController = [[WKUserContentController alloc] init];</span><br><span class="line">//æ³¨å†Œä¸€ä¸ªnameä¸ºjsToOcNoPramsçš„jsæ–¹æ³•ï¼Œè®¾ç½®å¤„ç†æ¥æ”¶JSæ–¹æ³•çš„ä»£ç†</span><br><span class="line">[wkUController addScriptMessageHandler:self  name:@&quot;jsToOcNoPrams&quot;];</span><br><span class="line">[wkUController addScriptMessageHandler:self  name:@&quot;jsToOcWithPrams&quot;];</span><br><span class="line">config.userContentController = wkUController;</span><br><span class="line">//ç”¨å®Œè®°å¾—ç§»é™¤</span><br><span class="line">//ç§»é™¤æ³¨å†Œçš„jsæ–¹æ³•</span><br><span class="line">[[_webView configuration].userContentController removeScriptMessageHandlerForName:@&quot;jsToOcNoPrams&quot;];</span><br><span class="line">[[_webView configuration].userContentController removeScriptMessageHandlerForName:@&quot;jsToOcWithPrams&quot;];</span><br></pre></td></tr></table></figure>
<ul>
<li>WKScriptMessageHandlerï¼šè¿™ä¸ªåè®®ç±»ä¸“é—¨ç”¨æ¥å¤„ç†ç›‘å¬JavaScriptæ–¹æ³•ä»è€Œè°ƒç”¨åŸç”ŸOCæ–¹æ³•ï¼Œå’ŒWKUserContentControlleræ­é…ä½¿ç”¨ã€‚</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">æ³¨æ„ï¼šéµå®ˆWKScriptMessageHandleråè®®ï¼Œä»£ç†æ˜¯ç”±WKUserContentControlè®¾ç½®</span><br><span class="line"></span><br><span class="line">//é€šè¿‡æ¥æ”¶JSä¼ å‡ºæ¶ˆæ¯çš„nameè¿›è¡Œæ•æ‰çš„å›è°ƒæ–¹æ³•</span><br><span class="line">- (void)userContentController:(WKUserContentController *)userContentController didReceiveScriptMessage:(WKScriptMessage *)message&#123;</span><br><span class="line">NSLog(@&quot;name:%@\\\\n body:%@\\\\n frameInfo:%@\\\\n&quot;,message.name,message.body,message.frameInfo);</span><br><span class="line">//ç”¨message.bodyè·å¾—JSä¼ å‡ºçš„å‚æ•°ä½“</span><br><span class="line">NSDictionary * parameter = message.body;</span><br><span class="line">//JSè°ƒç”¨OC</span><br><span class="line">if([message.name isEqualToString:@&quot;jsToOcNoPrams&quot;])&#123;</span><br><span class="line">UIAlertController *alertController = [UIAlertController alertControllerWithTitle:@&quot;jsè°ƒç”¨åˆ°äº†oc&quot; message:@&quot;ä¸å¸¦å‚æ•°&quot; preferredStyle:UIAlertControllerStyleAlert];</span><br><span class="line">[alertController addAction:([UIAlertAction actionWithTitle:@&quot;OK&quot; style:UIAlertActionStyleDefault handler:^(UIAlertAction * _Nonnull action) &#123;</span><br><span class="line">&#125;])];</span><br><span class="line">[self presentViewController:alertController animated:YES completion:nil];</span><br><span class="line"></span><br><span class="line">&#125;else if([message.name isEqualToString:@&quot;jsToOcWithPrams&quot;])&#123;</span><br><span class="line">UIAlertController *alertController = [UIAlertController alertControllerWithTitle:@&quot;jsè°ƒç”¨åˆ°äº†oc&quot; message:parameter[@&quot;params&quot;] preferredStyle:UIAlertControllerStyleAlert];</span><br><span class="line">[alertController addAction:([UIAlertAction actionWithTitle:@&quot;OK&quot; style:UIAlertActionStyleDefault handler:^(UIAlertAction * _Nonnull action) &#123;</span><br><span class="line">&#125;])];</span><br><span class="line">[self presentViewController:alertController animated:YES completion:nil];</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="äºŒã€WKWebViewæ¶‰åŠçš„ä»£ç†æ–¹æ³•"><a href="#äºŒã€WKWebViewæ¶‰åŠçš„ä»£ç†æ–¹æ³•" class="headerlink" title="äºŒã€WKWebViewæ¶‰åŠçš„ä»£ç†æ–¹æ³•"></a>äºŒã€WKWebViewæ¶‰åŠçš„ä»£ç†æ–¹æ³•</h2><ul>
<li>WKNavigationDelegate  ï¼šä¸»è¦å¤„ç†ä¸€äº›è·³è½¬ã€åŠ è½½å¤„ç†æ“ä½œ</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">// é¡µé¢å¼€å§‹åŠ è½½æ—¶è°ƒç”¨</span><br><span class="line">- (void)webView:(WKWebView *)webView didStartProvisionalNavigation:(WKNavigation *)navigation &#123;</span><br><span class="line">&#125;</span><br><span class="line">// é¡µé¢åŠ è½½å¤±è´¥æ—¶è°ƒç”¨</span><br><span class="line">- (void)webView:(WKWebView *)webView didFailProvisionalNavigation:(null_unspecified WKNavigation *)navigation withError:(NSError *)error &#123;</span><br><span class="line">[self.progressView setProgress:0.0f animated:NO];</span><br><span class="line">&#125; </span><br><span class="line">// å½“å†…å®¹å¼€å§‹è¿”å›æ—¶è°ƒç”¨</span><br><span class="line">- (void)webView:(WKWebView *)webView didCommitNavigation:(WKNavigation *)navigation &#123;</span><br><span class="line">&#125;</span><br><span class="line">// é¡µé¢åŠ è½½å®Œæˆä¹‹åè°ƒç”¨</span><br><span class="line">- (void)webView:(WKWebView *)webView didFinishNavigation:(WKNavigation *)navigation &#123;</span><br><span class="line">[self getCookie];</span><br><span class="line">&#125;</span><br><span class="line">//æäº¤å‘ç”Ÿé”™è¯¯æ—¶è°ƒç”¨</span><br><span class="line">- (void)webView:(WKWebView *)webView didFailNavigation:(WKNavigation *)navigation withError:(NSError *)error &#123;</span><br><span class="line">[self.progressView setProgress:0.0f animated:NO];</span><br><span class="line">&#125;  </span><br><span class="line">// æ¥æ”¶åˆ°æœåŠ¡å™¨è·³è½¬è¯·æ±‚å³æœåŠ¡é‡å®šå‘æ—¶ä¹‹åè°ƒç”¨</span><br><span class="line">- (void)webView:(WKWebView *)webView didReceiveServerRedirectForProvisionalNavigation:(WKNavigation *)navigation &#123;</span><br><span class="line">&#125;</span><br><span class="line">// æ ¹æ®WebViewå¯¹äºå³å°†è·³è½¬çš„HTTPè¯·æ±‚å¤´ä¿¡æ¯å’Œç›¸å…³ä¿¡æ¯æ¥å†³å®šæ˜¯å¦è·³è½¬</span><br><span class="line">- (void)webView:(WKWebView *)webView decidePolicyForNavigationAction:(WKNavigationAction *)navigationAction decisionHandler:(void (^)(WKNavigationActionPolicy))decisionHandler &#123;</span><br><span class="line"></span><br><span class="line">NSString * urlStr = navigationAction.request.URL.absoluteString;</span><br><span class="line">NSLog(@&quot;å‘é€è·³è½¬è¯·æ±‚ï¼š%@&quot;,urlStr);</span><br><span class="line">//è‡ªå·±å®šä¹‰çš„åè®®å¤´</span><br><span class="line">NSString *htmlHeadString = @&quot;github://&quot;;</span><br><span class="line">if([urlStr hasPrefix:htmlHeadString])&#123;</span><br><span class="line">UIAlertController *alertController = [UIAlertController alertControllerWithTitle:@&quot;é€šè¿‡æˆªå–URLè°ƒç”¨OC&quot; message:@&quot;ä½ æƒ³å‰å¾€æˆ‘çš„Githubä¸»é¡µ?&quot; preferredStyle:UIAlertControllerStyleAlert];</span><br><span class="line">[alertController addAction:([UIAlertAction actionWithTitle:@&quot;å–æ¶ˆ&quot; style:UIAlertActionStyleCancel handler:^(UIAlertAction * _Nonnull action) &#123;   </span><br><span class="line">&#125;])];</span><br><span class="line">[alertController addAction:([UIAlertAction actionWithTitle:@&quot;æ‰“å¼€&quot; style:UIAlertActionStyleDefault handler:^(UIAlertAction * _Nonnull action) &#123;</span><br><span class="line">NSURL * url = [NSURL URLWithString:[urlStr stringByReplacingOccurrencesOfString:@&quot;github://callName_?&quot; withString:@&quot;&quot;]];</span><br><span class="line">[[UIApplication sharedApplication] openURL:url];</span><br><span class="line">&#125;])];</span><br><span class="line">[self presentViewController:alertController animated:YES completion:nil];</span><br><span class="line">decisionHandler(WKNavigationActionPolicyCancel);</span><br><span class="line">&#125;else&#123;</span><br><span class="line">decisionHandler(WKNavigationActionPolicyAllow);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// æ ¹æ®å®¢æˆ·ç«¯å—åˆ°çš„æœåŠ¡å™¨å“åº”å¤´ä»¥åŠresponseç›¸å…³ä¿¡æ¯æ¥å†³å®šæ˜¯å¦å¯ä»¥è·³è½¬</span><br><span class="line">- (void)webView:(WKWebView *)webView decidePolicyForNavigationResponse:(WKNavigationResponse *)navigationResponse decisionHandler:(void (^)(WKNavigationResponsePolicy))decisionHandler&#123;</span><br><span class="line">NSString * urlStr = navigationResponse.response.URL.absoluteString;</span><br><span class="line">NSLog(@&quot;å½“å‰è·³è½¬åœ°å€ï¼š%@&quot;,urlStr);</span><br><span class="line">//å…è®¸è·³è½¬</span><br><span class="line">decisionHandler(WKNavigationResponsePolicyAllow);</span><br><span class="line">//ä¸å…è®¸è·³è½¬</span><br><span class="line">//decisionHandler(WKNavigationResponsePolicyCancel);</span><br><span class="line">&#125; </span><br><span class="line">//éœ€è¦å“åº”èº«ä»½éªŒè¯æ—¶è°ƒç”¨ åŒæ ·åœ¨blockä¸­éœ€è¦ä¼ å…¥ç”¨æˆ·èº«ä»½å‡­è¯</span><br><span class="line">- (void)webView:(WKWebView *)webView didReceiveAuthenticationChallenge:(NSURLAuthenticationChallenge *)challenge completionHandler:(void (^)(NSURLSessionAuthChallengeDisposition disposition, NSURLCredential * _Nullable credential))completionHandler&#123;</span><br><span class="line">//ç”¨æˆ·èº«ä»½ä¿¡æ¯</span><br><span class="line">NSURLCredential * newCred = [[NSURLCredential alloc] initWithUser:@&quot;user123&quot; password:@&quot;123&quot; persistence:NSURLCredentialPersistenceNone];</span><br><span class="line">//ä¸º challenge çš„å‘é€æ–¹æä¾› credential</span><br><span class="line">[challenge.sender useCredential:newCred forAuthenticationChallenge:challenge];</span><br><span class="line">completionHandler(NSURLSessionAuthChallengeUseCredential,newCred);</span><br><span class="line">&#125;</span><br><span class="line">//è¿›ç¨‹è¢«ç»ˆæ­¢æ—¶è°ƒç”¨</span><br><span class="line">- (void)webViewWebContentProcessDidTerminate:(WKWebView *)webView&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>WKUIDelegate ï¼šä¸»è¦å¤„ç†JSè„šæœ¬ï¼Œç¡®è®¤æ¡†ï¼Œè­¦å‘Šæ¡†ç­‰</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">/**</span><br><span class="line">*  webç•Œé¢ä¸­æœ‰å¼¹å‡ºè­¦å‘Šæ¡†æ—¶è°ƒç”¨</span><br><span class="line">*</span><br><span class="line">*  @param webView           å®ç°è¯¥ä»£ç†çš„webview</span><br><span class="line">*  @param message           è­¦å‘Šæ¡†ä¸­çš„å†…å®¹</span><br><span class="line">*  @param completionHandler è­¦å‘Šæ¡†æ¶ˆå¤±è°ƒç”¨</span><br><span class="line">*/</span><br><span class="line">- (void)webView:(WKWebView *)webView runJavaScriptAlertPanelWithMessage:(NSString *)message initiatedByFrame:(WKFrameInfo *)frame completionHandler:(void (^)(void))completionHandler &#123;</span><br><span class="line">UIAlertController *alertController = [UIAlertController alertControllerWithTitle:@&quot;HTMLçš„å¼¹å‡ºæ¡†&quot; message:message?:@&quot;&quot; preferredStyle:UIAlertControllerStyleAlert];</span><br><span class="line">[alertController addAction:([UIAlertAction actionWithTitle:@&quot;OK&quot; style:UIAlertActionStyleDefault handler:^(UIAlertAction * _Nonnull action) &#123;</span><br><span class="line">completionHandler();</span><br><span class="line">&#125;])];</span><br><span class="line">[self presentViewController:alertController animated:YES completion:nil];</span><br><span class="line">&#125;</span><br><span class="line">// ç¡®è®¤æ¡†</span><br><span class="line">//JavaScriptè°ƒç”¨confirmæ–¹æ³•åå›è°ƒçš„æ–¹æ³• confirmæ˜¯jsä¸­çš„ç¡®å®šæ¡†ï¼Œéœ€è¦åœ¨blockä¸­æŠŠç”¨æˆ·é€‰æ‹©çš„æƒ…å†µä¼ é€’è¿›å»</span><br><span class="line">- (void)webView:(WKWebView *)webView runJavaScriptConfirmPanelWithMessage:(NSString *)message initiatedByFrame:(WKFrameInfo *)frame completionHandler:(void (^)(BOOL))completionHandler&#123;</span><br><span class="line">UIAlertController *alertController = [UIAlertController alertControllerWithTitle:@&quot;&quot; message:message?:@&quot;&quot; preferredStyle:UIAlertControllerStyleAlert];</span><br><span class="line">[alertController addAction:([UIAlertAction actionWithTitle:@&quot;Cancel&quot; style:UIAlertActionStyleCancel handler:^(UIAlertAction * _Nonnull action) &#123;</span><br><span class="line">completionHandler(NO);</span><br><span class="line">&#125;])];</span><br><span class="line">[alertController addAction:([UIAlertAction actionWithTitle:@&quot;OK&quot; style:UIAlertActionStyleDefault handler:^(UIAlertAction * _Nonnull action) &#123;</span><br><span class="line">completionHandler(YES);</span><br><span class="line">&#125;])];</span><br><span class="line">[self presentViewController:alertController animated:YES completion:nil];</span><br><span class="line">&#125;</span><br><span class="line">// è¾“å…¥æ¡†</span><br><span class="line">//JavaScriptè°ƒç”¨promptæ–¹æ³•åå›è°ƒçš„æ–¹æ³• promptæ˜¯jsä¸­çš„è¾“å…¥æ¡† éœ€è¦åœ¨blockä¸­æŠŠç”¨æˆ·è¾“å…¥çš„ä¿¡æ¯ä¼ å…¥</span><br><span class="line">- (void)webView:(WKWebView *)webView runJavaScriptTextInputPanelWithPrompt:(NSString *)prompt defaultText:(NSString *)defaultText initiatedByFrame:(WKFrameInfo *)frame completionHandler:(void (^)(NSString * _Nullable))completionHandler&#123;</span><br><span class="line">UIAlertController *alertController = [UIAlertController alertControllerWithTitle:prompt message:@&quot;&quot; preferredStyle:UIAlertControllerStyleAlert];</span><br><span class="line">[alertController addTextFieldWithConfigurationHandler:^(UITextField * _Nonnull textField) &#123;</span><br><span class="line">textField.text = defaultText;</span><br><span class="line">&#125;];</span><br><span class="line">[alertController addAction:([UIAlertAction actionWithTitle:@&quot;OK&quot; style:UIAlertActionStyleDefault handler:^(UIAlertAction * _Nonnull action) &#123;</span><br><span class="line">completionHandler(alertController.textFields[0].text?:@&quot;&quot;);</span><br><span class="line">&#125;])];</span><br><span class="line">[self presentViewController:alertController animated:YES completion:nil];</span><br><span class="line">&#125;</span><br><span class="line">// é¡µé¢æ˜¯å¼¹å‡ºçª—å£ _blank å¤„ç†</span><br><span class="line">- (WKWebView *)webView:(WKWebView *)webView createWebViewWithConfiguration:(WKWebViewConfiguration *)configuration forNavigationAction:(WKNavigationAction *)navigationAction windowFeatures:(WKWindowFeatures *)windowFeatures &#123;</span><br><span class="line">if (!navigationAction.targetFrame.isMainFrame) &#123;</span><br><span class="line">[webView loadRequest:navigationAction.request];</span><br><span class="line">&#125;</span><br><span class="line">return nil;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="ä¸‰ã€ç½‘é¡µå†…å®¹åŠ è½½è¿›åº¦æ¡å’Œtitleçš„å®ç°"><a href="#ä¸‰ã€ç½‘é¡µå†…å®¹åŠ è½½è¿›åº¦æ¡å’Œtitleçš„å®ç°" class="headerlink" title="ä¸‰ã€ç½‘é¡µå†…å®¹åŠ è½½è¿›åº¦æ¡å’Œtitleçš„å®ç°"></a>ä¸‰ã€ç½‘é¡µå†…å®¹åŠ è½½è¿›åº¦æ¡å’Œtitleçš„å®ç°</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">//æ·»åŠ ç›‘æµ‹ç½‘é¡µåŠ è½½è¿›åº¦çš„è§‚å¯Ÿè€…</span><br><span class="line">[self.webView addObserver:self</span><br><span class="line">forKeyPath:@&quot;estimatedProgress&quot;</span><br><span class="line">options:0</span><br><span class="line">context:nil];</span><br><span class="line">//æ·»åŠ ç›‘æµ‹ç½‘é¡µæ ‡é¢˜titleçš„è§‚å¯Ÿè€…</span><br><span class="line">[self.webView addObserver:self</span><br><span class="line">forKeyPath:@&quot;title&quot;</span><br><span class="line">options:NSKeyValueObservingOptionNew</span><br><span class="line">context:nil];</span><br><span class="line"></span><br><span class="line">//kvo ç›‘å¬è¿›åº¦ å¿…é¡»å®ç°æ­¤æ–¹æ³•</span><br><span class="line">-(void)observeValueForKeyPath:(NSString *)keyPath</span><br><span class="line">ofObject:(id)object</span><br><span class="line">change:(NSDictionary&lt;NSKeyValueChangeKey,id&gt; *)change</span><br><span class="line">context:(void *)context&#123;</span><br><span class="line">if ([keyPath isEqualToString:NSStringFromSelector(@selector(estimatedProgress))]</span><br><span class="line">&amp;&amp; object == _webView) &#123;</span><br><span class="line">NSLog(@&quot;ç½‘é¡µåŠ è½½è¿›åº¦ = %f&quot;,_webView.estimatedProgress);</span><br><span class="line">self.progressView.progress = _webView.estimatedProgress;</span><br><span class="line">if (_webView.estimatedProgress &gt;= 1.0f) &#123;</span><br><span class="line">dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(0.3 * NSEC_PER_SEC)), dispatch_get_main_queue(), ^&#123;</span><br><span class="line">self.progressView.progress = 0;</span><br><span class="line">&#125;);</span><br><span class="line">&#125; </span><br><span class="line">&#125;else if([keyPath isEqualToString:@&quot;title&quot;]</span><br><span class="line">&amp;&amp; object == _webView)&#123;</span><br><span class="line">self.navigationItem.title = _webView.title;</span><br><span class="line">&#125;else&#123;</span><br><span class="line">[super observeValueForKeyPath:keyPath</span><br><span class="line">ofObject:object</span><br><span class="line">change:change</span><br><span class="line">context:context];</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">//ç§»é™¤è§‚å¯Ÿè€…</span><br><span class="line">[_webView removeObserver:self</span><br><span class="line">forKeyPath:NSStringFromSelector(@selector(estimatedProgress))];</span><br><span class="line">[_webView removeObserver:self</span><br><span class="line">forKeyPath:NSStringFromSelector(@selector(title))];</span><br></pre></td></tr></table></figure>
<h2 id="å››ã€JSå’ŒOCçš„äº¤äº’"><a href="#å››ã€JSå’ŒOCçš„äº¤äº’" class="headerlink" title="å››ã€JSå’ŒOCçš„äº¤äº’"></a>å››ã€JSå’ŒOCçš„äº¤äº’</h2><ul>
<li>JSè°ƒç”¨OC</li>
</ul>
<blockquote>
<p>è¿™ä¸ªå®ç°ä¸»è¦æ˜¯ä¾é WKScriptMessageHandleråè®®ç±»å’ŒWKUserContentControllerä¸¤ä¸ªç±»ï¼šWKUserContentControllerå¯¹è±¡è´Ÿè´£æ³¨å†ŒJSæ–¹æ³•ï¼Œè®¾ç½®å¤„ç†æ¥æ”¶JSæ–¹æ³•çš„ä»£ç†ï¼Œä»£ç†éµå®ˆWKScriptMessageHandlerï¼Œå®ç°æ•æ‰åˆ°JSæ¶ˆæ¯çš„å›è°ƒæ–¹æ³•ï¼Œè¯¦æƒ…å¯ä»¥çœ‹ç¬¬ä¸€æ­¥ä¸­å¯¹è¿™ä¸¤ä¸ªç±»çš„ä»‹ç»ã€‚</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">//è¿™ä¸ªç±»ä¸»è¦ç”¨æ¥åšnativeä¸JavaScriptçš„äº¤äº’ç®¡ç†</span><br><span class="line">WKUserContentController * wkUController = [[WKUserContentController alloc] init];</span><br><span class="line">//æ³¨å†Œä¸€ä¸ªnameä¸ºjsToOcNoPramsçš„jsæ–¹æ³•ï¼Œè®¾ç½®å¤„ç†æ¥æ”¶JSæ–¹æ³•çš„ä»£ç†</span><br><span class="line">[wkUController addScriptMessageHandler:self  name:@&quot;jsToOcNoPrams&quot;];</span><br><span class="line">[wkUController addScriptMessageHandler:self  name:@&quot;jsToOcWithPrams&quot;];</span><br><span class="line">config.userContentController = wkUController;</span><br><span class="line"></span><br><span class="line">æ³¨æ„ï¼šéµå®ˆWKScriptMessageHandleråè®®ï¼Œä»£ç†æ˜¯ç”±WKUserContentControlè®¾ç½®</span><br><span class="line">//é€šè¿‡æ¥æ”¶JSä¼ å‡ºæ¶ˆæ¯çš„nameè¿›è¡Œæ•æ‰çš„å›è°ƒæ–¹æ³•  jsè°ƒOC</span><br><span class="line">- (void)userContentController:(WKUserContentController *)userContentController didReceiveScriptMessage:(WKScriptMessage *)message&#123;</span><br><span class="line">NSLog(@&quot;name:%@\\\\n body:%@\\\\n frameInfo:%@\\\\n&quot;,message.name,message.body,message.frameInfo);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>OCè°ƒç”¨JS</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">//OCè°ƒç”¨JS  changeColor()æ˜¯JSæ–¹æ³•åï¼ŒcompletionHandleræ˜¯å¼‚æ­¥å›è°ƒblock</span><br><span class="line">NSString *jsString = [NSString stringWithFormat:@&quot;changeColor(&apos;%@&apos;)&quot;, @&quot;Jså‚æ•°&quot;];</span><br><span class="line">[_webView evaluateJavaScript:jsString completionHandler:^(id _Nullable data, NSError * _Nullable error) &#123;</span><br><span class="line">NSLog(@&quot;æ”¹å˜HTMLçš„èƒŒæ™¯è‰²&quot;);</span><br><span class="line">&#125;];</span><br><span class="line"></span><br><span class="line">//æ”¹å˜å­—ä½“å¤§å° è°ƒç”¨åŸç”ŸJSæ–¹æ³•</span><br><span class="line">NSString *jsFont = [NSString stringWithFormat:@&quot;document.getElementsByTagName(&apos;body&apos;)[0].style.webkitTextSizeAdjust= &apos;%d%%&apos;&quot;, arc4random()%99 + 100];</span><br><span class="line">[_webView evaluateJavaScript:jsFont completionHandler:nil];</span><br></pre></td></tr></table></figure>
<h2 id="äº”ã€æœ¬åœ°HTMLæ–‡ä»¶çš„å®ç°"><a href="#äº”ã€æœ¬åœ°HTMLæ–‡ä»¶çš„å®ç°" class="headerlink" title="äº”ã€æœ¬åœ°HTMLæ–‡ä»¶çš„å®ç°"></a>äº”ã€æœ¬åœ°HTMLæ–‡ä»¶çš„å®ç°</h2><blockquote>
<p>ç”±äº<a href="https://github.com/wslcmk/WKWebView" target="_blank" rel="noopener">ç¤ºä¾‹Demo</a>çš„éœ€è¦ä»¥åŠçŸ¥è¯†æœ‰é™ï¼Œæˆ‘ç”¨ä»…çŸ¥çš„HTMLã€CSSã€JavaScriptçš„ä¸€ç‚¹çš®æ¯›å†™äº†ä¸€ä¸ªHTMLæ–‡ä»¶ï¼Œæ¯”è¾ƒä¸šä½™ï¼Œå¤§ç¥å‹¿å–·ğŸ˜ğŸ˜<br>å°ç™½æƒ³å­¦ä¹ è¿™æ–¹é¢çš„çŸ¥è¯†å¯ä»¥çœ‹è¿™é‡Œï¼š <a href="http://www.w3school.com.cn/index.html" target="_blank" rel="noopener">http://www.w3school.com.cn/index.html</a></p>
</blockquote>
<blockquote>
<p>æˆ‘ç”¨MACè‡ªå¸¦çš„æ–‡æœ¬ç¼–è¾‘å·¥å…·ï¼Œç”Ÿæˆä¸€ä¸ªæ–‡ä»¶ï¼Œæ”¹åç¼€åï¼Œå¼ºè½¬ä¸º.htmlæ–‡ä»¶ï¼ŒåŒæ—¶è¿˜éœ€è¦è®¾ç½®æ–‡æœ¬ç¼–è¾‘æ‰“å¼€HTMLæ–‡ä»¶æ—¶æ˜¾ç¤ºä»£ç ï¼ˆå¦‚ä¸‹å›¾ï¼‰ï¼Œç„¶åç¼–è¾‘ä»£ç ã€‚</p>
</blockquote>
<p><img src="https://upload-images.jianshu.io/upload_images/1708447-44824f3cec7bad72.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="æ–‡æœ¬ç¼–è¾‘åå¥½è®¾ç½®.png"></p>
<p>è¯¦æƒ…è¯·å‰å¾€æˆ‘çš„Githubï¼š<a href="https://github.com/wslcmk/WKWebView" target="_blank" rel="noopener">WKWebViewçš„ä½¿ç”¨</a></p>
<p>å¦‚æœæˆ‘WKWebViewä½¿ç”¨çš„æ€»ç»“æ²¡å¸®åˆ°ä½ ï¼Œä½ ä¹Ÿå¯ä»¥çœ‹çœ‹ä¸‹é¢å‡ ç¯‡æ–‡ï¼š<br><a href="https://www.jianshu.com/p/833448c30d70" target="_blank" rel="noopener">https://www.jianshu.com/p/833448c30d70</a><br><a href="https://www.jianshu.com/p/4fa8c4eb1316" target="_blank" rel="noopener">https://www.jianshu.com/p/4fa8c4eb1316</a><br><a href="https://www.jianshu.com/p/91cfe58c032d" target="_blank" rel="noopener">https://www.jianshu.com/p/91cfe58c032d</a></p>
<p><img src="https://upload-images.jianshu.io/upload_images/1708447-8039532e25fcee13.gif?imageMogr2/auto-orient/strip" alt=""></p>

      
    </div>
    
    
    

    

    
      <div>
        <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
  <div>åšæŒåŸåˆ›æŠ€æœ¯åˆ†äº«ï¼Œæ‚¨çš„æ”¯æŒå°†é¼“åŠ±æˆ‘ç»§ç»­åˆ›ä½œï¼</div>
  <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
    <span>æ‰“èµ</span>
  </button>
  <div id="QR" style="display: none;">

    
      <div id="wechat" style="display: inline-block">
        <img id="wechat_qr" src="/images/wechat-reward-image.jpeg" alt="ä¸”è¡Œä¸”çæƒœ_iOS å¾®ä¿¡æ”¯ä»˜"/>
        <p>å¾®ä¿¡æ”¯ä»˜</p>
      </div>
    

    
      <div id="alipay" style="display: inline-block">
        <img id="alipay_qr" src="/images/alipay-reward-image.jpeg" alt="ä¸”è¡Œä¸”çæƒœ_iOS æ”¯ä»˜å®"/>
        <p>æ”¯ä»˜å®</p>
      </div>
    

    

  </div>
</div>

      </div>
    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/iOS/" rel="tag"># iOS</a>
          
            <a href="/tags/WKWebView/" rel="tag"># WKWebView</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/10/03/è·å–ç‰¹å®šä½ç½®çš„cell/" rel="next" title="iOS  UITableView/UICollectionViewè·å–ç‰¹å®šä½ç½®çš„cell">
                <i class="fa fa-chevron-left"></i> iOS  UITableView/UICollectionViewè·å–ç‰¹å®šä½ç½®çš„cell
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2018/10/03/å…¨å±ä¾§æ»‘æ‰‹åŠ¿-UIScrollView-UISlideré—´æ»‘åŠ¨æ‰‹åŠ¿å†²çª/" rel="prev" title="iOS å±ä¾§æ»‘æ‰‹åŠ¿/UIScrollView/UISlideré—´æ»‘åŠ¨æ‰‹åŠ¿å†²çª">
                iOS å±ä¾§æ»‘æ‰‹åŠ¿/UIScrollView/UISlideré—´æ»‘åŠ¨æ‰‹åŠ¿å†²çª <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            æ–‡ç« ç›®å½•
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            ç«™ç‚¹æ¦‚è§ˆ
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="https://upload.jianshu.io/collections/images/1661007/è‰¾ç›Â·æ²ƒç‰¹æ£®.jpeg?imageMogr2/auto-orient/strip|imageView2/1/w/240/h/240"
                alt="ä¸”è¡Œä¸”çæƒœ_iOS" />
            
              <p class="site-author-name" itemprop="name">ä¸”è¡Œä¸”çæƒœ_iOS</p>
              <p class="site-description motion-element" itemprop="description">â€» å¾®ä¿¡å…¬ä¼—å·ï¼šiOS2679114653 â€» QQï¼š1685527540</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">21</span>
                  <span class="site-state-item-name">æ—¥å¿—</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">1</span>
                  <span class="site-state-item-name">åˆ†ç±»</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">36</span>
                  <span class="site-state-item-name">æ ‡ç­¾</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/wsl2ls" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://www.jianshu.com/u/e15d1f644bea" target="_blank" title="ç®€ä¹¦">
                      
                        <i class="fa fa-fw fa-globe"></i>ç®€ä¹¦</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#å‰è¨€"><span class="nav-number">1.</span> <span class="nav-text">å‰è¨€</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ä¸€ã€WKWebViewæ¶‰åŠçš„ä¸€äº›ç±»"><span class="nav-number"></span> <span class="nav-text">ä¸€ã€WKWebViewæ¶‰åŠçš„ä¸€äº›ç±»</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#äºŒã€WKWebViewæ¶‰åŠçš„ä»£ç†æ–¹æ³•"><span class="nav-number"></span> <span class="nav-text">äºŒã€WKWebViewæ¶‰åŠçš„ä»£ç†æ–¹æ³•</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ä¸‰ã€ç½‘é¡µå†…å®¹åŠ è½½è¿›åº¦æ¡å’Œtitleçš„å®ç°"><span class="nav-number"></span> <span class="nav-text">ä¸‰ã€ç½‘é¡µå†…å®¹åŠ è½½è¿›åº¦æ¡å’Œtitleçš„å®ç°</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#å››ã€JSå’ŒOCçš„äº¤äº’"><span class="nav-number"></span> <span class="nav-text">å››ã€JSå’ŒOCçš„äº¤äº’</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#äº”ã€æœ¬åœ°HTMLæ–‡ä»¶çš„å®ç°"><span class="nav-number"></span> <span class="nav-text">äº”ã€æœ¬åœ°HTMLæ–‡ä»¶çš„å®ç°</span></a></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">ä¸”è¡Œä¸”çæƒœ_iOS</span>

  
</div>









        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  






  
  







  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  

  
  
    <script type="text/javascript" src="/lib/three/three.min.js"></script>
  

  
  
    <script type="text/javascript" src="/lib/three/canvas_lines.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
